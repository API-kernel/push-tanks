name: Deploy to Servers

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - name: RU Server
            host: ${{ secrets.HOST }}     
          - name: NL Server
            host: ${{ secrets.HOST_NL }}  
            
    steps:
      - name: Deploying to ${{ matrix.name }}
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ matrix.host }}
          username: ${{ secrets.USERNAME }} 
          key: ${{ secrets.SSH_KEY }}       
          port: 22
          script: |
            # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É
            cd /var/www/tanks
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
            git reset --hard origin/master
            git pull origin master
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
            npm install
            
            # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PM2
            pm2 restart all
            
            echo "DEPLOY TO ${{ matrix.name }} SUCCESSFUL! üöÄ"